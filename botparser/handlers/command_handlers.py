import json
import os
from aiogram import Router, F
from aiogram.filters import CommandStart
from aiogram.types import Message, CallbackQuery
from keyboards import search_menu
from aiogram.filters import Command

command_router = Router()

# –®–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É –∑ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
users_file = "users.json"

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —É —Ñ–∞–π–ª
def save_user_data(user_id, username, first_name):
    try:
        # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ
        with open("users.json", "r", encoding="utf-8") as f:
            users = json.load(f)
    except FileNotFoundError:
        # –Ø–∫—â–æ —Ñ–∞–π–ª –Ω–µ —ñ—Å–Ω—É—î, —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫
        users = []

    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–∂–µ —î —É —Å–ø–∏—Å–∫—É
    for user in users:
        if user["id"] == user_id:
            return  # –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–∂–µ —î, –Ω–µ –¥–æ–¥–∞—î–º–æ –π–æ–≥–æ –∑–Ω–æ–≤—É

    # –î–æ–¥–∞—î–º–æ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    users.append({
        "id": user_id,
        "username": username,
        "first_name": first_name
    })

    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω—ñ –¥–∞–Ω—ñ —É —Ñ–∞–π–ª
    with open("users.json", "w", encoding="utf-8") as f:
        json.dump(users, f, ensure_ascii=False, indent=4)

@command_router.message(CommandStart())
async def start_command(message: Message):
    """
    –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start.
    """
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    user_id = message.from_user.id
    username = message.from_user.username
    first_name = message.from_user.first_name
    save_user_data(user_id, username, first_name)

    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
    await message.answer(
        f"–ü—Ä–∏–≤—ñ—Ç, {message.from_user.first_name}! üëã\n"
        "–Ø –¥–æ–ø–æ–º–æ–∂—É —Ç–æ–±—ñ –∑–±—ñ—Ä–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ –∑ –∫–∞–Ω–∞–ª—É –≤ —Å–ø–∏—Å–æ–∫ —Ç–µ–ª–µ–≥—Ä–∞–ºüí¨\n"
        "–ø–æ –∫–Ω–æ–ø—Ü—ñ –Ω–∏–∂–µ‚¨áÔ∏è —Ç–∏ –º–æ–∂–µ—à –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è –≤–µ—Å—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ë–æ—Ç–∞üåü\n"
        "\n", reply_markup=search_menu,
    )


@command_router.callback_query(F.data == "info")
async def cmd_info(callback: CallbackQuery):
    await callback.answer('info')
    await callback.message.answer(f"–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ë–æ—Ç–∞ü§ñ \n"
                                  "\n"
                                  "–ø–æ –∫–æ–º–∞–Ω–¥—ñ /parser [—Å–∏–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª] ‚ö†Ô∏è –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –∫–∞–Ω–∞–ª –º–∞—î –±—É—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏–º \n"
                                  "\n"
                                  "–ø–æ –∫–æ–º–∞–Ω–¥—ñ /piplist –ø–∞—Ä—Å—ñ–Ω–≥ –ø—Ä–æ–π—à–æ–≤ —É—Å–ø—ñ—à–Ω–æ —Ç–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø–æ —Ü—ñ–π –∫–æ–º–∞–Ω–¥—ñ‚úÖ\n"
                                  "\n"
                                  "–ø–æ –∫–æ–º–∞–Ω–¥—ñ /clear –≤–∏ –æ—á–∏—â–∞—î—Ç–µ —Å–ø–∏—Å–æ–∫ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–±–∏—Ç–∏ –¥–ª—è —Ç–æ–≥–æ —â–æ–±–∏ —Å–ø–∏—Å–æ–∫ –≤–∏–¥–∞–≤–∞–≤—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ\n"
                                  "\n"
                                  "–ø–æ –∫–æ–º–∞–Ω–¥—ñ /help –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç–∏ –≤ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –∞–±–æ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é\n"
                                  "\n"
                                  "–©–æ–±–∏ –ø–æ–ª—É—á–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ—É–Ω–∫—Ü—ñ–π‚ö†Ô∏è /parser , /piplist –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–≤—è–∑–∞—Ç–∏—Å—è –∑ –∞–¥–º—ñ–Ω—ñ—Å—Ç–∞—Ä—Ü—ñ—î—é\n"
                                  "–≤–∏ —Ü–µ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /help \n"
                                  )







# –°–ø–∏—Å–æ–∫ ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
ADMINS = [1332517469 , 6395768505] # –ó–∞–º—ñ—Å—Ç—å —Ü–∏—Ö ID –≤—Å—Ç–∞–≤—Ç–µ —Ä–µ–∞–ª—å–Ω—ñ ID –≤–∞—à–∏—Ö –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤

@command_router.message(Command("list"))
async def command_piplist(message: Message):
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –∞–¥–º—ñ–Ω–æ–º
    if message.from_user.id in ADMINS:
        await message.answer(
            "Command - /start '–∑–∞–ø—É—Å–∫ —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞'\n"
            "\n"
            "Command - /help '–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤ –±–æ—Ç—ñ'\n"
            "\n"
            "Command - /sendall '–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–æ–∑—Å–∏–ª–∫–∏-—Ä–µ–∫–ª–∞–º–∏'\n"
            "\n"
            "Command - /piplist '–≤–∏–¥–∞–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤ —É —Å–ø–∏—Å–∫—É'\n"
            "\n"
            "Command - /clear '–æ—á–∏—â–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤'\n"
            "\n"
            "Command - /reply '–≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É —Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω–∞–º!'\n"
            "\n"
            "Command - /list '–ø–æ–¥–∏–≤–∏—Ç–∏—Å—è —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥–∏' \n"
            "\n"
            "Command - /admin '–∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è'\n"
            "\n"
            "Comm–∞nd - /add ID '–≤–∏–¥–∞—î –ø—Ä–∞–≤–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ —Ñ—É–Ω–∫—Ü—ñ–π /parser'\n"
            "\n"
            "Comm–∞nd - /addoff ID '–∑–∞–±–∏—Ä–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Ñ—É–Ω–∫—Ü—ñ–π /parser'\n"
            "\n"
            "Comm–∞nd - /online '–ø–æ —Ü—ñ–π –∫–æ–º–∞–Ω–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ –±–æ—Ç—ñ'\n"
            "\n"
            "Comm–∞nd - /maintenance '–ø–æ —Ü—ñ–π –∫–æ–º–∞–Ω–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –±–æ—Ç–∞ —â–æ–±–∏ –æ–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–æ–∫'\n"
            "\n"
            "Comm–∞nd - /list_users '—Ü—è –∫–æ–º–∞–Ω–¥–∞ –ø–æ–∫–∞–∑—É—î –≤–∞–º –≤—Å—é –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ª—é–¥–µ–π –≤ –±–æ—Ç—ñ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö'\n"
            "\n"
            "Comm–∞nd - /addinfo '–ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ —Å–µ–∞–Ω—Å–∏ –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ /parser'\n"
            "\n")
    else:
        await message.answer("–£ –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏. ‚ùå")